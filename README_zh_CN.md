# Auto-SRT Android

[English Documentation](README.md)

一个Android应用，可以自动从视频文件生成SRT字幕文件，使用火山引擎的语音识别API。

## 功能特性

- 📹 从设备中选择视频文件
- 🎵 从视频中提取音频轨道
- 🗣️ 使用火山引擎API将语音转换为文字
- 📝 自动生成SRT字幕文件
- ⚙️ 简单的API密钥配置
- 📋 实时日志显示，便于监控过程和问题诊断

## 界面截图

### 主界面
- 选择视频文件
- 开始转换过程
- 查看转换进度和结果
- 实时监控带时间戳的日志
- 按需清除日志

### 设置界面
- 配置API Key和Access Key
- 安全保存凭证

## 系统要求

- Android 5.0 (API level 21) 或更高版本
- 互联网连接
- 火山引擎API凭证（API Key和Access Key）

## 如何获取API凭证

1. 访问[火山引擎控制台](https://console.volcengine.com/)
2. 注册并创建新应用
3. 进入语音识别服务
4. 获取您的API Key和Access Key
5. 更多信息请参考[火山引擎语音识别文档](https://www.volcengine.com/docs/6561/1354868)

## 安装

1. 克隆此仓库：
```bash
git clone https://github.com/yourusername/auto-srt-android.git
```

2. 在Android Studio中打开项目

3. 在设备或模拟器上构建并运行应用

## 使用方法

1. **配置API密钥**
   - 打开应用并点击"API配置"
   - 输入您的火山引擎API Key和Access Key
   - 点击"保存配置"

2. **转换视频为字幕**
   - 点击"选择视频文件"
   - 从设备中选择一个视频
   - 点击"开始转换"
   - 在日志区域监控转换过程
   - 等待处理完成

3. **监控处理日志**
   - 在转换过程中查看详细的步骤日志
   - 检查每个操作的时间戳
   - 如果转换失败，查看错误信息
   - 点击"清除日志"清空日志显示

4. **访问字幕文件**
   - 生成的SRT文件将保存在应用的数据目录中
   - 文件名将与视频文件名相同，扩展名为`.srt`
   - 在日志中查看确切的文件路径

## 项目结构

```
app/
├── src/main/
│   ├── java/com/example/autosrt/
│   │   ├── MainActivity.kt          # 主Activity
│   │   ├── SettingsActivity.kt      # API配置界面
│   │   ├── AudioExtractor.kt        # 音频提取工具
│   │   ├── VolcEngineAPI.kt         # 火山引擎API客户端
│   │   └── SRTGenerator.kt          # SRT文件生成器
│   ├── res/
│   │   ├── layout/                  # UI布局
│   │   └── values/                  # 资源文件
│   └── AndroidManifest.xml
└── build.gradle
```

## 技术细节

### 音频提取
- 使用Android的MediaExtractor和MediaMuxer API
- 从视频文件中提取音频轨道
- 输出单声道音频

### API集成
- 实现火山引擎的大模型语音识别API
- 支持base64音频数据上传
- 处理异步任务提交和查询

### SRT生成
- 解析带有时间信息的API响应
- 按照SRT规范格式化输出
- 处理多种响应格式

## 依赖库

- OkHttp: 用于API请求的HTTP客户端
- Gson: JSON序列化/反序列化
- AndroidX: Android支持库
- Material Design组件: UI组件

## 权限说明

应用需要以下权限：
- `INTERNET`: 用于API通信
- `READ_EXTERNAL_STORAGE`: 读取视频文件
- `WRITE_EXTERNAL_STORAGE`: 保存字幕文件

## 限制说明

- 最大音频文件大小取决于API限制
- 处理时间因音频长度而异
- 需要稳定的互联网连接

## 工作流程

1. **视频选择**: 用户从设备中选择视频文件，日志记录选择的文件信息
2. **音频提取**: 应用从视频中提取音频轨道，保存为临时文件，日志显示提取进度
3. **API调用**: 将音频文件通过base64编码上传到火山引擎API，日志记录任务ID
4. **任务查询**: 轮询查询任务状态（每10秒），日志实时显示轮询状态和进度
5. **字幕生成**: 解析API返回的识别结果，生成SRT格式的字幕文件，日志显示生成详情
6. **文件保存**: 将字幕文件保存到应用数据目录，文件名与原视频相同，日志显示完整路径

## 贡献

欢迎贡献！请随时提交Pull Request。

## 开源协议

本项目采用[MIT协议](LICENSE)开源。

## 致谢

- [火山引擎](https://www.volcengine.com/)提供语音识别API
- Android开发社区

## 技术支持

如果您遇到任何问题或有疑问，请：
1. 查看[Issues](https://github.com/yourusername/auto-srt-android/issues)页面
2. 如果问题未列出，请创建新issue
3. 提供详细的问题信息

## 常见问题

**Q: 支持哪些视频格式？**
A: 支持Android系统原生支持的所有视频格式（如MP4、MKV、AVI等）。

**Q: 生成的字幕文件保存在哪里？**
A: 字幕文件保存在应用的数据目录中，可以在应用完成转换后看到完整路径。

**Q: 转换需要多长时间？**
A: 转换时间取决于视频长度和网络速度，通常为视频时长的1-2倍。

**Q: 是否支持多语言识别？**
A: 取决于火山引擎API的配置，默认支持中文识别。

*Q: API调用需要费用吗？**
A: 请参考火山引擎的定价政策，通常提供免费额度。

**Q: 如果转换失败怎么办？**
A: 查看日志区域的详细错误信息，通常会显示失败的具体原因和建议解决方案。

## 故障排除

### 使用日志功能
应用包含了完善的日志系统，帮助诊断问题：

1. **日志显示区域**
   - 位于控制按钮下方
   - 显示每个操作的时间戳消息
   - 自动滚动显示最新的日志条目

2. **日志信息包含**
   - 视频选择和文件信息
   - 音频提取进度和结果
   - API通信详情（任务ID、轮询状态）
   - SRT生成状态和文件路径
   - 详细的错误消息和堆栈跟踪

3. **常见问题诊断**
   - **音频提取失败**: 检查视频文件是否有效且包含音频轨道
   - **API调用失败**: 在设置中验证您的API凭证是否正确
   - **网络错误**: 确保您有稳定的互联网连接
   - **文件保存失败**: 检查存储权限是否已授予

### 如何使用日志排查问题

1. 在开始转换前，先点击"清除日志"清空之前的记录
2. 执行转换操作，观察日志输出
3. 如果出现错误，日志会显示 `[ERROR]` 标记
4. 记录完整的错误信息，包括时间戳和详细描述
5. 根据错误信息采取相应的解决措施

## 更新日志

### 版本 1.1.0 (2026-01-04)
- 新增实时日志显示功能
- 每条日志添加时间戳
- 新增清除日志功能
- 改进错误报告，包含详细堆栈跟踪
- 增强故障排除能力
- 优化用户体验和问题诊断流程

### 版本 1.0.0
- 初始版本发布
- 基本的视频转字幕功能
- API密钥配置功能
- SRT文件生成功能

## 开发计划

- [x] 实时日志显示和问题诊断
- [ ] 支持批量处理多个视频
- [ ] 添加字幕编辑功能
- [ ] 支持更多输出格式（ASS、VTT等）
- [ ] 优化音频提取性能
- [ ] 添加离线字幕翻译功能
- [ ] 支持字幕时间轴调整
- [ ] 日志导出功能

## 联系方式

如有任何问题或建议，请通过以下方式联系：
- 提交Issue
- Pull Request
- 邮件联系

---

**注意**: 使用本应用前，请确保您已经获取了有效的火山引擎API凭证，并遵守相关服务条款。